## MongoDB 特性

MongoDB 没有像 SQL 一样有自动增长的功能， MongoDB 的 _id 是系统自动生成的 12 字节唯一标识。

### MongoDB 关系

MongoDB 的关系表示多个文档之间在逻辑上的相互联系。

文档间可以通过嵌入和引用来建立联系。

* 嵌入式关系的缺点是，如果数据量不断变大，会影响读写性能。
* 引用式关系是涉及数据库时经常用到的方法，通过引用文档的 id 字段来建立关系。

### MongoDB 数据库引用

* 手动引用
* DBRefs：一个文档从多个集合引用文档

DBRefs 的格式：
// $ref：集合名称，$id：引用的id，$db:数据库名称，可选参数
`{ $ref : , $id : , $db :  }`

### MongoDB 覆盖索引查询

因为索引存在于RAM中，从索引中获取数据比通过扫描文档读取数据要快得多。

覆盖查询是以下的查询：

* 所有的查询字段是索引的一部分
* 所有的查询返回字段在同一个索引中

不能使用覆盖索引查询：

* 所有索引字段是一个数组
* 所有索引字段是一个子文档

### MongoDB 查询分析

MongoDB 查询分析常用函数有：explain() 和 hint()。可以确保我们建议的索引是否有效。

explain 操作提供了查询信息，使用索引及查询统计等。有利于我们对索引的优化。

使用 hint 来强制 MongoDB 使用一个指定的索引。

### MongoDB 原子操作

MongoDB 不支持事务，不能保证数据的完整性。

MongoDB 提供了许多原子操作，比如文档的保存，修改，删除等，都是原子操作。

原子操作常用命令：

// 用来指定一个键并更新键值，若键不存在并创建
`{ $set : { field : value } }`

// 用来删除一个键
`{ $unset : { field : 1} }`

// 可以对文档的某个值为数字型（只能为满足要求的数字）的键进行增减的操作。
`{ $inc : { field : value } }`

// 把 value 追加到 field 里面去，field 一定要是数组类型才行，如果 field 不存在，会新增一个数组类型加进去。
`{ $push : { field : value } }`

// 同 $push，只是一次可以追加多个值到一个数组字段内。
`{ $pushAll : { field : value_array } }`

// 从数组 field 内删除一个等于 value 值。
`{ $pull : { field : _value } }`

// 删除数组的第一个或最后一个元素
`{ $pop : { field : 1 } }`

// 修改字段名称
`{ $rename : { old_field_name : new_field_name } }`

// 位操作，integer 类型
`{$bit : { field : {and : 5}}}`

### MongoDB 高级索引

* 索引数组字段：对集合中的数组建立索引
* 索引子文档字段：对集合中的子文档建立索引

### MongoDB 索引限制

每个索引占据一定的存储空间，在进行插入，更新和删除操作时也需要对索引进行操作。

如果很少对集合进行读取操作，建议不使用索引。

由于索引是存储在内存(RAM)中，应该确保该索引的大小不超过内存的限制。

索引范围：

* 集合中索引不能超过 64 个
* 索引名的长度不能超过 128 个字符
* 一个复合索引最多可以有 31 个字段

### MongoDB ObjectId

ObjectId 是一个12字节 BSON 类型数据。

前 4 个字节表示时间戳，接下来的 3 个字节是机器标识码，紧接的两个字节由进程 id 组成(PID)，最后三个字节是随机数。

### MongoDB Map Reduce

Map-Reduce 是一种计算模型，简单的说就是将大批量的工作（数据）分解（MAP）执行，然后再将结果合并成最终结果（REDUCE）。

### MongoDB 全文检索

全文检索对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，
检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。

这个过程类似于通过字典中的检索字表查字的过程。

### MongoDB 正则表达式

正则表达式是使用单个字符串来描述、匹配一系列符合某个句法规则的字符串。

MongoDB 使用 $regex 操作符来设置匹配字符串的正则表达式。

### MongoDB 管理工具

* Rockmongo：用 PHP5 写的一个 MongoDB 管理工具。

